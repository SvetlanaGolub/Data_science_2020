---
title: "Лабораторная работа №6"
author: "Голуб Светлана"
output:
  word_document: default
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: inline
always_allow_html: true
---

# Подготовка данных 

1. Загружаем данные:

```{r}
setwd("D:/MyDoc/Desktop/MEPhI/data_science/lab6")
dataset <- read.csv("zeta.csv")
```

2. Удаляем дубликаты строк по столбцу meanhouseholdincome:  

```{r}
library(dplyr)
dataset <- distinct(dataset, meanhouseholdincome, .keep_all = TRUE)
```

3. Удаляем столбцы zcta, sex:

```{r}
dataset <- subset(dataset, select = -c(zcta, sex))
```

4. Убираем выбросы из датасета:

```{r}
dataset.filtered <- subset(dataset, 8 < meaneducation & meaneducation < 18 & 10000 < meanhouseholdincome & meanhouseholdincome < 200000 & 0 < meanemployment & meanemployment < 3 & 20 < meanage & meanage < 60)
```

5. Добавляем столбец с логорифмированным доход:

```{r}
dataset.filtered <- cbind(dataset.filtered, log_income = log10(dataset.filtered$meanhouseholdincome))
```

6. Переиминовываем столбцы:

```{r}
data <- rename(dataset.filtered, age = meanage, education = meaneducation, employment = meanemployment)
```


# Ход работы

В данной лабораторной работе мы считаем доход зависимой переменной, а остальные столбцы независимыми переменными.

a. Строим точечную диаграмму зависимости дохода от возраста:

```{r}
library(hexbin)
hexbinplot(log_income ~ age, data = data)
```

На данной диаграмме не наблюдается линейная зависимость параметров друг от друга.

b. Строим линейную регрессионную модель зависимости дохода от возраста и выводим отчёт по модели:

```{r}
regmodel.age <- lm(log_income ~ age, data = data)
summary(regmodel.age)
```
t-value - критерий, который позволяет определить значимость фактора. Чем больше t-value, тем больше коэффициент при параметре отличен от нуля, соответственно имеет большее значение. (Делим коэффициент на стандартную ошибку оценки коэффициента)

c. R-squared value - доля дисперсии зависимой переменной, которую может объяснить модель.(Дисперсия - мера разброса значений случайной величины относительно её математического ожидания). Чем ближе к 1, тем ярче выражена зависимость.

d. F-statistic - используется для оценки значимости модели регрессии в целом, является соотношением объяснимой дисперсии, к необъяснимой. Необъяснимая дисперсия - сумма квадратов откланений предсказываемого значения от фактического. Если модель линейной регрессии построена удачно, то она объясняет значительную часть дисперсии, оставляя в знаменателе малую часть. Чем больше значение параметра — тем лучше.

Полученная линейная регрессионная модель далека от идеала. У модели очень маленькое значение R-квадрата, что говорит о большой доле необъяснимой дисперсии (значительное откланение предполагаемых значений от реальных). 

g. Построим точечную диаграмму зависимости дохода от образования:

```{r}
hexbinplot(log_income ~ education, data = data)
```

Данная зависимость напоминает линейную.

g. Составим и проанализируем линейную регрессионную модель:

```{r}
regmodel.ed <- lm(log_income ~ education, data = data)
summary(regmodel.ed)
```

У этой модели больше значение t-критерия. Это значит, что фактор education более значимый. Также больше R-квадрат, что говорит о хорошем приближении предсказываемых значений к реальным. По значению F-статистики видно, что доля объяснимой дисперсии больше, чем необъяснимой. 

h. Составим множественную регрессионную модель на основе всех столбцов:

```{r}
regmodel.all <- lm(log_income ~ age + education + employment, data = data)
summary(regmodel.all)
```

Достаточно хорошая, но не идеальная модель. R-квадрат достаточно близок к 1, что говорит о большой доле объяснимых отклонений, предположительные точки близки к реальным. F-статистика соответсвтенно тоже большая и вероятность правдоподобности нулевой гепотизы p-value мала (значит коэффициенты имеют вес).  
Можно сделать вывод, что переменная age имеет наиболее сслабую линейную зависимость, так как её коэффициент и t-критерий достаточно малы.

i. Коэффициент при пареметре education : 0.0920728
Коэффициент b0 : 3.5064582
Предположим, что остальные параметры постоянно равны нулю. 
Посчитаем значение дохода для education = 0 и для education = 1 и найдём процентное соотношение. 

> (3.5064582 + 0.0920728) / 3.5064582 - 1 = **`r (3.5064582 + 0.0920728) / 3.5064582 - 1`**  
>
Доход вырос на **3%**

Также можно попробовать посчитать процентное изменение дохода с помощью функции предсказания:

```{r}
prediction = predict(regmodel.all, data.frame(age = c(0, 0, 0, 0), education = c(0, 1, 2,3), employment = c(0, 0, 0, 0)))
prediction[4] / prediction[3] - 1
prediction[3] / prediction[2] - 1
prediction[2] / prediction[1] - 1
```

j. Построим график, содержащий линию x = y, и сравним предсказанные точки с реальными:

```{r}
prediction.all <- predict(regmodel.all)
plot(prediction.all, data$log_income)
abline(a = 0, b = 1)
```

k. Предсказанные точки у идеальной модели будут лежать вдоль графика y = x.
В нашем случае для низких даходов предсказание точек очень хорошее, для средних приемлемое, а для высоких доходов значения занижаются.
